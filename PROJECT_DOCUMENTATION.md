# Документация проекта Chestmate

## Обзор проекта

Chestmate - это полноценная платформа электронной коммерции, разработанная на фреймворке Laravel с использованием SQLite в качестве базы данных. Проект представляет собой основу для создания интернет-магазина с полным набором необходимых функций.

## Архитектура проекта

Проект следует архитектуре MVC (Model-View-Controller), присущей фреймворку Laravel:

1. **Модели (Models)** - представляют структуры данных и бизнес-логику:
   - `User` - пользователи системы
   - `Category` - категории товаров с поддержкой вложенности
   - `Product` - товары магазина
   - `Order` - заказы пользователей
   - `OrderItem` - элементы заказа (конкретные товары)

2. **Контроллеры (Controllers)** - обрабатывают запросы и управляют логикой приложения:
   - `API/AuthController` - аутентификация пользователей
   - `API/CategoryController` - управление категориями
   - `API/ProductController` - управление товарами
   - `API/OrderController` - управление заказами

3. **Маршруты (Routes)** - определяют URL-структуру приложения:
   - `api.php` - маршруты для REST API
   - `web.php` - маршруты для веб-интерфейса

## База данных

Структура базы данных включает следующие таблицы:

1. **users** - пользователи системы
   - id (PK) - уникальный идентификатор
   - name - имя пользователя
   - email - электронная почта (уникальная)
   - password - хэш пароля
   - remember_token - токен для функции "запомнить меня"
   - email_verified_at - время подтверждения email
   - created_at, updated_at - временные метки

2. **categories** - категории товаров
   - id (PK) - уникальный идентификатор
   - name - название категории
   - slug - SEO-дружественный URL
   - description - описание категории
   - parent_id (FK) - ссылка на родительскую категорию (для вложенности)
   - created_at, updated_at - временные метки

3. **products** - товары
   - id (PK) - уникальный идентификатор
   - name - название товара
   - slug - SEO-дружественный URL
   - description - описание товара
   - price - цена
   - stock - количество на складе
   - is_active - активен ли товар (доступен для покупки)
   - category_id (FK) - принадлежность к категории
   - image - путь к изображению товара
   - created_at, updated_at - временные метки

4. **orders** - заказы
   - id (PK) - уникальный идентификатор
   - user_id (FK) - идентификатор пользователя
   - order_number - уникальный номер заказа
   - status - статус заказа (pending, processing, completed, cancelled)
   - total_amount - общая сумма заказа
   - shipping_address - адрес доставки
   - billing_address - адрес для выставления счёта
   - payment_method - метод оплаты
   - is_paid - статус оплаты
   - paid_at - время оплаты
   - created_at, updated_at - временные метки

5. **order_items** - элементы заказа
   - id (PK) - уникальный идентификатор
   - order_id (FK) - идентификатор заказа
   - product_id (FK) - идентификатор товара
   - quantity - количество
   - price - цена на момент заказа
   - created_at, updated_at - временные метки

## Отношения между моделями

1. **User** (Пользователь):
   - Имеет множество Order (заказов) - отношение one-to-many

2. **Category** (Категория):
   - Может иметь родительскую Category - отношение self-referencing
   - Может иметь множество дочерних Category - отношение one-to-many (self-referencing)
   - Имеет множество Product (товаров) - отношение one-to-many

3. **Product** (Товар):
   - Принадлежит одной Category - отношение many-to-one
   - Может быть в множестве OrderItem - отношение one-to-many

4. **Order** (Заказ):
   - Принадлежит одному User - отношение many-to-one
   - Имеет множество OrderItem - отношение one-to-many

5. **OrderItem** (Элемент заказа):
   - Принадлежит одному Order - отношение many-to-one
   - Привязан к одному Product - отношение many-to-one

## API-интерфейс

Проект предоставляет REST API для интеграции с внешними системами:

1. **Аутентификация**:
   - `POST /api/register` - регистрация нового пользователя
     - Параметры: name, email, password, password_confirmation
     - Возвращает: информацию о пользователе и токен доступа
   
   - `POST /api/login` - вход в систему
     - Параметры: email, password
     - Возвращает: информацию о пользователе и токен доступа
   
   - `POST /api/logout` - выход из системы (требует аутентификации)
     - Параметры: нет
     - Возвращает: сообщение об успешном выходе

2. **Категории**:
   - `GET /api/categories` - получение всех категорий
     - Параметры: нет
     - Возвращает: список всех категорий верхнего уровня с дочерними категориями
   
   - `GET /api/categories/{id}` - получение конкретной категории
     - Параметры: id категории
     - Возвращает: информацию о категории, дочерние категории и товары
   
   - `POST /api/categories` - создание категории (требует аутентификации)
     - Параметры: name, description, parent_id (опционально)
     - Возвращает: созданную категорию
   
   - `PUT /api/categories/{id}` - обновление категории (требует аутентификации)
     - Параметры: name, description, parent_id (все опционально)
     - Возвращает: обновленную категорию
   
   - `DELETE /api/categories/{id}` - удаление категории (требует аутентификации)
     - Параметры: id категории
     - Возвращает: сообщение об успешном удалении

3. **Товары**:
   - `GET /api/products` - получение списка товаров
     - Параметры:
       - category_id (фильтр по категории)
       - search (поиск по имени)
       - is_active (фильтр по активности)
       - sort (поле для сортировки)
       - direction (направление сортировки)
       - per_page (количество элементов на странице)
     - Возвращает: пагинированный список товаров
   
   - `GET /api/products/{id}` - получение конкретного товара
     - Параметры: id товара
     - Возвращает: информацию о товаре с категорией
   
   - `POST /api/products` - создание товара (требует аутентификации)
     - Параметры: name, description, price, stock, category_id, is_active, image
     - Возвращает: созданный товар
   
   - `PUT /api/products/{id}` - обновление товара (требует аутентификации)
     - Параметры: name, description, price, stock, category_id, is_active, image (все опционально)
     - Возвращает: обновленный товар
   
   - `DELETE /api/products/{id}` - удаление товара (требует аутентификации)
     - Параметры: id товара
     - Возвращает: сообщение об успешном удалении

4. **Заказы**:
   - `GET /api/orders` - получение списка заказов пользователя (требует аутентификации)
     - Параметры:
       - status (фильтр по статусу)
       - sort (поле для сортировки)
       - direction (направление сортировки)
     - Возвращает: пагинированный список заказов пользователя
   
   - `POST /api/orders` - создание заказа (требует аутентификации)
     - Параметры:
       - shipping_address (адрес доставки)
       - billing_address (адрес для выставления счёта)
       - payment_method (метод оплаты)
       - items (массив товаров с product_id и quantity)
     - Возвращает: созданный заказ с элементами
   
   - `GET /api/orders/{id}` - получение информации о заказе (требует аутентификации)
     - Параметры: id заказа
     - Возвращает: информацию о заказе с элементами и товарами

## Тестовые данные

Проект включает сидеры для заполнения базы данных тестовыми данными:

1. `UserSeeder` - создает:
   - Администратора с email: admin@chestmate.com и паролем: password
   - 50 обычных пользователей с случайными данными

2. `CategorySeeder` - создает:
   - 8 основных категорий: Электроника, Одежда, Дом и сад, Спорт и отдых, Книги и медиа, Красота и здоровье, Игрушки и игры, Продукты питания
   - 5 подкатегорий для каждой основной категории (всего 40 подкатегорий)

3. `ProductSeeder` - создает:
   - От 5 до 15 товаров для каждой подкатегории
   - Товары с случайными ценами, описаниями и уровнями запасов

4. `OrderSeeder` - создает:
   - От 0 до 5 заказов для каждого пользователя
   - От 1 до 5 товаров в каждом заказе
   - Разные статусы заказов и методы оплаты

## Основные команды для работы с проектом

### Установка и настройка

1. **Клонирование репозитория**:
   ```bash
   git clone https://github.com/MailBoxer1/chestmate.git
   cd chestmate
   ```

2. **Установка зависимостей**:
   ```bash
   composer install
   ```

3. **Настройка окружения**:
   ```bash
   cp .env.example .env
   php artisan key:generate
   ```

4. **Подготовка базы данных SQLite**:
   ```bash
   touch database/database.sqlite
   ```

5. **Миграция и заполнение базы данных**:
   ```bash
   php artisan migrate:fresh --seed
   ```

### Разработка

1. **Запуск сервера разработки**:
   ```bash
   php artisan serve
   ```
   Сервер будет доступен по адресу http://localhost:8000

2. **Создание новых моделей и миграций**:
   ```bash
   php artisan make:model ИмяМодели -m
   ```
   Эта команда создаст модель и соответствующую миграцию.

3. **Создание контроллеров**:
   ```bash
   php artisan make:controller ИмяКонтроллера
   ```
   Для API-контроллеров используйте флаг `--api`:
   ```bash
   php artisan make:controller API/ИмяКонтроллера --api
   ```

4. **Создание сидеров**:
   ```bash
   php artisan make:seeder ИмяСидера
   ```

5. **Создание фабрик**:
   ```bash
   php artisan make:factory ИмяФабрики
   ```

6. **Запуск миграций**:
   ```bash
   php artisan migrate
   ```

7. **Откат миграций**:
   ```bash
   php artisan migrate:rollback
   ```

8. **Запуск сидеров**:
   ```bash
   php artisan db:seed
   php artisan db:seed --class=ИмяСидера
   ```

9. **Просмотр маршрутов**:
   ```bash
   php artisan route:list
   ```

10. **Очистка кэша**:
    ```bash
    php artisan config:clear
    php artisan cache:clear
    php artisan route:clear
    php artisan view:clear
    ```

11. **Работа с Tinker (консоль для взаимодействия с приложением)**:
    ```bash
    php artisan tinker
    ```
    Пример использования:
    ```php
    App\Models\User::all(); // Вывести всех пользователей
    App\Models\Product::where('price', '>', 100)->get(); // Найти товары дороже 100
    ```

### Тестирование API

Для тестирования API можно использовать такие инструменты как Postman или cURL.

Примеры запросов:

1. **Регистрация**:
   ```bash
   curl -X POST http://localhost:8000/api/register \
     -H "Content-Type: application/json" \
     -d '{"name":"Тестовый пользователь","email":"test@example.com","password":"password","password_confirmation":"password"}'
   ```

2. **Вход в систему**:
   ```bash
   curl -X POST http://localhost:8000/api/login \
     -H "Content-Type: application/json" \
     -d '{"email":"test@example.com","password":"password"}'
   ```

3. **Получение списка товаров**:
   ```bash
   curl -X GET http://localhost:8000/api/products
   ```

4. **Получение заказов (с токеном)**:
   ```bash
   curl -X GET http://localhost:8000/api/orders \
     -H "Authorization: Bearer ВАШ_ТОКЕН"
   ```

### Рабочий процесс разработки

1. **Создание ветки для новой функции**:
   ```bash
   git checkout -b feature/имя-функции
   ```

2. **Внесение изменений и коммит**:
   ```bash
   git add .
   git commit -m "Описание изменений"
   ```

3. **Отправка изменений на GitHub**:
   ```bash
   git push origin feature/имя-функции
   ```

4. **Создание Pull Request на GitHub**:
   Через веб-интерфейс GitHub создайте Pull Request из вашей ветки в main

5. **Обновление локального репозитория**:
   ```bash
   git checkout main
   git pull
   ```

## Расширение проекта

Для дальнейшего развития проекта рекомендуется реализовать:

1. **Fronted-интерфейс** - Разработка веб-интерфейса для клиентов и администраторов
2. **Система оплаты** - Интеграция с платёжными шлюзами
3. **Система доставки** - Расчёт стоимости доставки и интеграция с службами доставки
4. **Расширенный поиск** - Внедрение системы поиска с фильтрами и фасетами
5. **Рекомендательная система** - Алгоритмы рекомендаций для повышения продаж
6. **Аналитика** - Статистика и аналитика продаж для бизнес-решений
7. **Многоязычность** - Поддержка нескольких языков
8. **CMS** - Система управления контентом для статических страниц

## Структура проекта

```
chestmate/
├── app/                    # Основной код приложения
│   ├── Console/            # Консольные команды
│   ├── Exceptions/         # Обработчики исключений
│   ├── Http/
│   │   ├── Controllers/    # Контроллеры
│   │   │   └── API/        # API контроллеры
│   │   ├── Middleware/     # Промежуточное ПО
│   │   └── Kernel.php      # HTTP ядро
│   ├── Models/             # Модели данных
│   └── Providers/          # Сервис-провайдеры
├── bootstrap/              # Файлы для запуска приложения
├── config/                 # Конфигурационные файлы
├── database/
│   ├── factories/          # Фабрики для тестовых данных
│   ├── migrations/         # Миграции базы данных
│   ├── seeders/            # Сидеры для базы данных
│   └── database.sqlite     # SQLite база данных
├── public/                 # Публично доступные файлы
├── resources/
│   ├── css/                # CSS стили
│   ├── js/                 # JavaScript файлы
│   └── views/              # Шаблоны представлений
├── routes/
│   ├── api.php             # API маршруты
│   └── web.php             # Веб маршруты
├── storage/                # Хранилище файлов
├── tests/                  # Тесты
├── vendor/                 # Зависимости Composer
├── .env                    # Файл окружения
├── .gitignore              # Исключения Git
├── composer.json           # Описание зависимостей
├── package.json            # Описание npm-пакетов
└── README.md               # Описание проекта
```

## Лицензия

Проект распространяется под лицензией MIT. 